`/bin/bash -c "save_history() {
    if [[ \"false\" == \"true\" ]]; then
        echo \" ---> \$BASH_COMMAND\" >&2
    fi
     history -s \"\$BASH_COMMAND\"
    history -a
}

save_env() {
    set +x
    set > /meta/.env
    # Ignore read-only variables
    for l in BASHOPTS BASH_VERSINFO UID EUID PPID SHELLOPTS; do
        grep -v \"^\$l=\" /meta/.env > /meta/.env2
        mv /meta/.env2 /meta/.env
    done
    echo \"cd \$(pwd)\" >> /meta/.env
}

# If /meta is mounted, then we want to save history and environment
if [[ -d /meta ]]; then
    trap save_history DEBUG
    trap save_env INT TERM EXIT ERR
fi

# Stop if we hit any errors.
set -e


cd \$WORKSPACE/srcdir
mkdir arpack-build
cd arpack-build

if [[ \${nbits} == 64 ]]; then
     cmake ../arpack-ng -DCMAKE_INSTALL_PREFIX=\$prefix -DCMAKE_TOOLCHAIN_FILE=/opt/\$target/\$target.toolchain -DBUILD_SHARED_LIBS=ON -DBLAS_LIBRARIES=\"-L\$prefix/lib -lopenblas64_\" -DLAPACK_LIBRARIES=\"-L\$prefix/lib -lopenblas64_\" -DCMAKE_Fortran_FLAGS=\"-O2 -fPIC -ffixed-line-length-none -cpp -fdefault-integer-8 -Dsaxpy=saxpy_64 -Ddaxpy=daxpy_64  -Dscopy=scopy_64 -Ddcopy=dcopy_64  -Dsgemv=sgemv_64 -Ddgemv=dgemv_64  -Dsgeqr2=sgeqr2_64 -Ddgeqr2=dgeqr2_64  -Dslacpy=slacpy_64 -Ddlacpy=dlacpy_64  -Dslahqr=slahqr_64 -Ddlahqr=dlahqr_64  -Dslanhs=slanhs_64 -Ddlanhs=dlanhs_64  -Dslarnv=slarnv_64 -Ddlarnv=dlarnv_64  -Dslartg=slartg_64 -Ddlartg=dlartg_64  -Dslascl=slascl_64 -Ddlascl=dlascl_64  -Dslaset=slaset_64 -Ddlaset=dlaset_64  -Dsscal=sscal_64 -Ddscal=dscal_64  -Dstrevc=strevc_64 -Ddtrevc=dtrevc_64  -Dstrmm=strmm_64 -Ddtrmm=dtrmm_64  -Dstrsen=strsen_64 -Ddtrsen=dtrsen_64  -Dsgbmv=sgbmv_64 -Ddgbmv=dgbmv_64  -Dsgbtrf=sgbtrf_64 -Ddgbtrf=dgbtrf_64  -Dsgbtrs=sgbtrs_64 -Ddgbtrs=dgbtrs_64  -Dsgttrf=sgttrf_64 -Ddgttrf=dgttrf_64  -Dsgttrs=sgttrs_64 -Ddgttrs=dgttrs_64  -Dspttrf=spttrf_64 -Ddpttrf=dpttrf_64  -Dspttrs=spttrs_64 -Ddpttrs=dpttrs_64  -Dsdot=sdot_64 -Dddot=ddot_64  -Dsger=sger_64 -Ddger=dger_64  -Dslabad=slabad_64 -Ddlabad=dlabad_64  -Dslaev2=slaev2_64 -Ddlaev2=dlaev2_64  -Dslamch=slamch_64 -Ddlamch=dlamch_64  -Dslanst=slanst_64 -Ddlanst=dlanst_64  -Dslanv2=slanv2_64 -Ddlanv2=dlanv2_64  -Dslapy2=slapy2_64 -Ddlapy2=dlapy2_64  -Dslarf=slarf_64 -Ddlarf=dlarf_64  -Dslarfg=slarfg_64 -Ddlarfg=dlarfg_64  -Dslasr=slasr_64 -Ddlasr=dlasr_64  -Dsnrm2=snrm2_64 -Ddnrm2=dnrm2_64  -Dsorm2r=sorm2r_64 -Ddorm2r=dorm2r_64  -Dsrot=srot_64 -Ddrot=drot_64  -Dssteqr=ssteqr_64 -Ddsteqr=dsteqr_64  -Dsswap=sswap_64 -Ddswap=dswap_64  -Dcaxpy=caxpy_64 -Dzaxpy=zaxpy_64  -Dccopy=ccopy_64 -Dzcopy=zcopy_64  -Dcgemv=cgemv_64 -Dzgemv=zgemv_64  -Dcgeqr2=cgeqr2_64 -Dzgeqr2=zgeqr2_64  -Dclacpy=clacpy_64 -Dzlacpy=zlacpy_64  -Dclahqr=clahqr_64 -Dzlahqr=zlahqr_64  -Dclanhs=clanhs_64 -Dzlanhs=zlanhs_64  -Dclarnv=clarnv_64 -Dzlarnv=zlarnv_64  -Dclartg=clartg_64 -Dzlartg=zlartg_64  -Dclascl=clascl_64 -Dzlascl=zlascl_64  -Dclaset=claset_64 -Dzlaset=zlaset_64  -Dcscal=cscal_64 -Dzscal=zscal_64  -Dctrevc=ctrevc_64 -Dztrevc=ztrevc_64  -Dctrmm=ctrmm_64 -Dztrmm=ztrmm_64  -Dctrsen=ctrsen_64 -Dztrsen=ztrsen_64  -Dcgbmv=cgbmv_64 -Dzgbmv=zgbmv_64  -Dcgbtrf=cgbtrf_64 -Dzgbtrf=zgbtrf_64  -Dcgbtrs=cgbtrs_64 -Dzgbtrs=zgbtrs_64  -Dcgttrf=cgttrf_64 -Dzgttrf=zgttrf_64  -Dcgttrs=cgttrs_64 -Dzgttrs=zgttrs_64  -Dcpttrf=cpttrf_64 -Dzpttrf=zpttrf_64  -Dcpttrs=cpttrs_64 -Dzpttrs=zpttrs_64  -Dcdotc=cdotc_64 -Dzdotc=zdotc_64  -Dcgeru=cgeru_64 -Dzgeru=zgeru_64  -Dcunm2r=cunm2r_64 -Dzunm2r=zunm2r_64  -DSCOPY=SCOPY_64 -DDCOPY=DCOPY_64  -DSLABAD=SLABAD_64 -DDLABAD=DLABAD_64  -DSLAMCH=SLAMCH_64 -DDLAMCH=DLAMCH_64  -DSLANHS=SLANHS_64 -DDLANHS=DLANHS_64  -DSLANV2=SLANV2_64 -DDLANV2=DLANV2_64  -DSLARFG=SLARFG_64 -DDLARFG=DLARFG_64  -DSROT=SROT_64 -DDROT=DROT_64  -DSGEMV=SGEMV_64 -DDGEMV=DGEMV_64 -Dscnrm2=scnrm2_64 -Ddznrm2=dznrm2_64 -Dcsscal=csscal_64 -Dzdscal=zdscal_64\"

else

     cmake ../arpack-ng -DCMAKE_INSTALL_PREFIX=\$prefix -DCMAKE_TOOLCHAIN_FILE=/opt/\$target/\$target.toolchain -DBUILD_SHARED_LIBS=ON -DBLAS_LIBRARIES=\"-L\$prefix/lib -lopenblas\" -DLAPACK_LIBRARIES=\"-L\$prefix/lib -lopenblas\" -DCMAKE_Fortran_FLAGS=\"-O2 -fPIC -ffixed-line-length-none -cpp\"

fi

make install

# For now, we'll have to adjust the name of the OpenBLAS library on macOS.
# Eventually, this should be fixed upstream
if [[ \${target} == \"x86_64-apple-darwin14\" ]]; then
    echo \"-- Modifying library name for OpenBLAS\"
    install_name_tool -change libopenblas64_.0.2.20.dylib @rpath/libopenblas64_.dylib \${prefix}/lib/libarpack.2.0.0.dylib
fi


"`
-- The C compiler identification is GNU 7.3.0
-- The Fortran compiler identification is GNU 7.3.0
-- Check for working C compiler: /opt/x86_64-linux-gnu/bin/x86_64-linux-gnu-gcc
-- Check for working C compiler: /opt/x86_64-linux-gnu/bin/x86_64-linux-gnu-gcc -- works
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - done
-- Detecting C compile features
-- Detecting C compile features - done
-- Check for working Fortran compiler: /opt/x86_64-linux-gnu/bin/x86_64-linux-gnu-gfortran
-- Check for working Fortran compiler: /opt/x86_64-linux-gnu/bin/x86_64-linux-gnu-gfortran  -- works
-- Detecting Fortran compiler ABI info
-- Detecting Fortran compiler ABI info - done
-- Checking whether /opt/x86_64-linux-gnu/bin/x86_64-linux-gnu-gfortran supports Fortran 90
-- Checking whether /opt/x86_64-linux-gnu/bin/x86_64-linux-gnu-gfortran supports Fortran 90 -- yes
-- Looking for pthread.h
-- Looking for pthread.h - found
-- Looking for pthread_create
-- Looking for pthread_create - not found
-- Looking for pthread_create in pthreads
-- Looking for pthread_create in pthreads - not found
-- Looking for pthread_create in pthread
-- Looking for pthread_create in pthread - found
-- Found Threads: TRUE  
-- Found BLAS: -L/workspace/destdir/lib -lopenblas64_  
-- A library with LAPACK API found.
-- Detecting Fortran/C Interface
-- Detecting Fortran/C Interface - Found GLOBAL and MODULE mangling
-- Configuring done
-- Generating done
-- Build files have been written to: /workspace/srcdir/arpack-build
Scanning dependencies of target arpack
[  1%] Building Fortran object CMakeFiles/arpack.dir/UTIL/icnteq.f.o
[  2%] Building Fortran object CMakeFiles/arpack.dir/UTIL/icopy.f.o
[  3%] Building Fortran object CMakeFiles/arpack.dir/UTIL/iset.f.o
[  4%] Building Fortran object CMakeFiles/arpack.dir/UTIL/iswap.f.o
[  6%] Building Fortran object CMakeFiles/arpack.dir/UTIL/ivout.f.o
[  7%] Building Fortran object CMakeFiles/arpack.dir/UTIL/second_NONE.f.o
[  8%] Building Fortran object CMakeFiles/arpack.dir/UTIL/svout.f.o
[  9%] Building Fortran object CMakeFiles/arpack.dir/UTIL/smout.f.o
[ 11%] Building Fortran object CMakeFiles/arpack.dir/UTIL/dvout.f.o
[ 12%] Building Fortran object CMakeFiles/arpack.dir/UTIL/dmout.f.o
[ 13%] Building Fortran object CMakeFiles/arpack.dir/UTIL/cvout.f.o
[ 14%] Building Fortran object CMakeFiles/arpack.dir/UTIL/cmout.f.o
[ 16%] Building Fortran object CMakeFiles/arpack.dir/UTIL/zvout.f.o
[ 17%] Building Fortran object CMakeFiles/arpack.dir/UTIL/zmout.f.o
[ 18%] Building Fortran object CMakeFiles/arpack.dir/SRC/cgetv0.f.o
[ 19%] Building Fortran object CMakeFiles/arpack.dir/SRC/cnaitr.f.o
[ 20%] Building Fortran object CMakeFiles/arpack.dir/SRC/cnapps.f.o
[ 22%] Building Fortran object CMakeFiles/arpack.dir/SRC/cnaup2.f.o
[ 23%] Building Fortran object CMakeFiles/arpack.dir/SRC/cnaupd.f.o
[ 24%] Building Fortran object CMakeFiles/arpack.dir/SRC/cneigh.f.o
[ 25%] Building Fortran object CMakeFiles/arpack.dir/SRC/cneupd.f.o
[ 27%] Building Fortran object CMakeFiles/arpack.dir/SRC/cngets.f.o
[ 28%] Building Fortran object CMakeFiles/arpack.dir/SRC/csortc.f.o
[ 29%] Building Fortran object CMakeFiles/arpack.dir/SRC/cstatn.f.o
[ 30%] Building Fortran object CMakeFiles/arpack.dir/SRC/dgetv0.f.o
[ 32%] Building Fortran object CMakeFiles/arpack.dir/SRC/dnaitr.f.o
[ 33%] Building Fortran object CMakeFiles/arpack.dir/SRC/dnapps.f.o
[ 34%] Building Fortran object CMakeFiles/arpack.dir/SRC/dnaup2.f.o
[ 35%] Building Fortran object CMakeFiles/arpack.dir/SRC/dnaupd.f.o
[ 37%] Building Fortran object CMakeFiles/arpack.dir/SRC/dnconv.f.o
[ 38%] Building Fortran object CMakeFiles/arpack.dir/SRC/dneigh.f.o
[ 39%] Building Fortran object CMakeFiles/arpack.dir/SRC/dneupd.f.o
[ 40%] Building Fortran object CMakeFiles/arpack.dir/SRC/dngets.f.o
[ 41%] Building Fortran object CMakeFiles/arpack.dir/SRC/dsaitr.f.o
[ 43%] Building Fortran object CMakeFiles/arpack.dir/SRC/dsapps.f.o
[ 44%] Building Fortran object CMakeFiles/arpack.dir/SRC/dsaup2.f.o
[ 45%] Building Fortran object CMakeFiles/arpack.dir/SRC/dsaupd.f.o
[ 46%] Building Fortran object CMakeFiles/arpack.dir/SRC/dsconv.f.o
[ 48%] Building Fortran object CMakeFiles/arpack.dir/SRC/dseigt.f.o
[ 49%] Building Fortran object CMakeFiles/arpack.dir/SRC/dsesrt.f.o
[ 50%] Building Fortran object CMakeFiles/arpack.dir/SRC/dseupd.f.o
[ 51%] Building Fortran object CMakeFiles/arpack.dir/SRC/dsgets.f.o
[ 53%] Building Fortran object CMakeFiles/arpack.dir/SRC/dsortc.f.o
[ 54%] Building Fortran object CMakeFiles/arpack.dir/SRC/dsortr.f.o
[ 55%] Building Fortran object CMakeFiles/arpack.dir/SRC/dstatn.f.o
[ 56%] Building Fortran object CMakeFiles/arpack.dir/SRC/dstats.f.o
[ 58%] Building Fortran object CMakeFiles/arpack.dir/SRC/dstqrb.f.o
[ 59%] Building Fortran object CMakeFiles/arpack.dir/SRC/sgetv0.f.o
[ 60%] Building Fortran object CMakeFiles/arpack.dir/SRC/snaitr.f.o
[ 61%] Building Fortran object CMakeFiles/arpack.dir/SRC/snapps.f.o
[ 62%] Building Fortran object CMakeFiles/arpack.dir/SRC/snaup2.f.o
[ 64%] Building Fortran object CMakeFiles/arpack.dir/SRC/snaupd.f.o
[ 65%] Building Fortran object CMakeFiles/arpack.dir/SRC/snconv.f.o
[ 66%] Building Fortran object CMakeFiles/arpack.dir/SRC/sneigh.f.o
[ 67%] Building Fortran object CMakeFiles/arpack.dir/SRC/sneupd.f.o
[ 69%] Building Fortran object CMakeFiles/arpack.dir/SRC/sngets.f.o
[ 70%] Building Fortran object CMakeFiles/arpack.dir/SRC/ssaitr.f.o
[ 71%] Building Fortran object CMakeFiles/arpack.dir/SRC/ssapps.f.o
[ 72%] Building Fortran object CMakeFiles/arpack.dir/SRC/ssaup2.f.o
[ 74%] Building Fortran object CMakeFiles/arpack.dir/SRC/ssaupd.f.o
[ 75%] Building Fortran object CMakeFiles/arpack.dir/SRC/ssconv.f.o
[ 76%] Building Fortran object CMakeFiles/arpack.dir/SRC/sseigt.f.o
[ 77%] Building Fortran object CMakeFiles/arpack.dir/SRC/ssesrt.f.o
[ 79%] Building Fortran object CMakeFiles/arpack.dir/SRC/sseupd.f.o
[ 80%] Building Fortran object CMakeFiles/arpack.dir/SRC/ssgets.f.o
[ 81%] Building Fortran object CMakeFiles/arpack.dir/SRC/ssortc.f.o
[ 82%] Building Fortran object CMakeFiles/arpack.dir/SRC/ssortr.f.o
[ 83%] Building Fortran object CMakeFiles/arpack.dir/SRC/sstatn.f.o
[ 85%] Building Fortran object CMakeFiles/arpack.dir/SRC/sstats.f.o
[ 86%] Building Fortran object CMakeFiles/arpack.dir/SRC/sstqrb.f.o
[ 87%] Building Fortran object CMakeFiles/arpack.dir/SRC/zgetv0.f.o
[ 88%] Building Fortran object CMakeFiles/arpack.dir/SRC/znaitr.f.o
[ 90%] Building Fortran object CMakeFiles/arpack.dir/SRC/znapps.f.o
[ 91%] Building Fortran object CMakeFiles/arpack.dir/SRC/znaup2.f.o
[ 92%] Building Fortran object CMakeFiles/arpack.dir/SRC/znaupd.f.o
[ 93%] Building Fortran object CMakeFiles/arpack.dir/SRC/zneigh.f.o
[ 95%] Building Fortran object CMakeFiles/arpack.dir/SRC/zneupd.f.o
[ 96%] Building Fortran object CMakeFiles/arpack.dir/SRC/zngets.f.o
[ 97%] Building Fortran object CMakeFiles/arpack.dir/SRC/zsortc.f.o
[ 98%] Building Fortran object CMakeFiles/arpack.dir/SRC/zstatn.f.o
[100%] Linking Fortran shared library lib/libarpack.so
[100%] Built target arpack
Install the project...
-- Install configuration: "Release"
-- Installing: /workspace/destdir/lib/libarpack.so.2.0.0
-- Installing: /workspace/destdir/lib/libarpack.so.2
-- Installing: /workspace/destdir/lib/libarpack.so
